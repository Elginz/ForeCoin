{% extends "layouts/base.html" %}

{% block title %} Dashboard - Market Overview {% endblock %}

{% block content %}

    <!-- Card for Key prices -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card price-card border-0 shadow">
                <div class="card-header bg-dark text-black text-center"><h2 class="fs-5 fw-bold mb-0">Key Prices</h2></div>
                <div class="card-body">
                    {% for asset_symbol in assets %}
                    {% set data = initial_data.get(asset_symbol, {}) %}
                    {% set kline = data.get('kline', {}) %}
                    <div class="asset-row d-flex justify-content-between align-items-center mb-2" data-symbol="{{ asset_symbol }}" data-search-content="{{ (asset_names.get(asset_symbol, '') + ' ' + asset_symbol) | lower }}">                        <h5 class="mb-0">{{ asset_names.get(asset_symbol, asset_symbol) }}</h5>
                        <span id="current-price-{{ asset_symbol }}" class="fw-bold fs-5">
                            {% if asset_symbol in STABLE_ASSETS %}${{ "%.2f" % kline.get('close', 0) }}{% else %}${{ "%.8f" % kline.get('close', 0) }}{% endif %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    <!-- Card for Market Sentiment Overview -->
        <div class="col-12 mb-4">
            <div class="card sentiment-card border-0 shadow">
                <div class="card-header bg-dark text-black text-center"><h2 class="fs-5 fw-bold mb-0">Market Sentiment Overview</h2></div>
                <div class="card-body p-2">
                    {% for asset_symbol in assets %}
                    <div class="asset-row d-flex justify-content-between align-items-center mb-2" data-symbol="{{ asset_symbol }}" data-search-content="{{ (asset_names.get(asset_symbol, '') + ' ' + asset_symbol) | lower }}">                        <h5 class="mb-2">{{ asset_names.get(asset_symbol, asset_symbol) }}</h5>
                        <span id="sentiment-label-{{ asset_symbol }}" class="badge bg-secondary">Loading...</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    <!-- Card for Chronos T5 Prediction -->
        <div class="col-12 mb-4">
            <div class="card sentiment-card border-0 shadow">
                <div class="card-header bg-dark text-black text-center"><h2 class="fs-5 fw-bold mb-0">Chronos T5 Prediction</h2></div>
                <div class="card-body p-2">
                    {% for asset_symbol in assets %}
                    {% set prediction_data = initial_data.get(asset_symbol, {}).get('prediction', {}) %}
                    <div class="asset-row d-flex justify-content-between align-items-center mb-2" data-symbol="{{ asset_symbol }}" data-search-content="{{ (asset_names.get(asset_symbol, '') + ' ' + asset_symbol) | lower }}">                        <h5 class="mb-0">{{ asset_names.get(asset_symbol, asset_symbol) }}</h5>
                        <span id="chronos-prediction-{{ asset_symbol }}" class="fw-bold fs-6">
                            {% if asset_symbol in STABLE_ASSETS %}
                                ${{ "%.2f" % prediction_data.get('chronos_next_hour_close', 0) }}
                            {% else %}
                                ${{ "%.8f" % prediction_data.get('chronos_next_hour_close', 0) }}
                            {% endif %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block javascripts %}
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='assets/js/dashboard_updater.js') }}"></script>
{% endblock javascripts %}
